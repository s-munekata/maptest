<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>‰∏Ä„ÉéÁÄ¨„Éà„É≥„Éç„É´Ê∞óË±°„Éû„ÉÉ„Éî„É≥„Ç∞</title>
  <style>
    #map {
      height: 100vh;
      width: 100%;
    }
    .custom-label {
      position: absolute;
      background: rgba(255, 255, 255, 0.85);
      color: #d40000;
      padding: 4px 10px;
      border-radius: 8px;
      font-weight: bold;
      font-size: 16px;
      white-space: nowrap;
      transform: translate(-50%, -50%);
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      font-family: "Segoe UI", sans-serif;
    }
    .infobox {
      font-family: "Segoe UI", sans-serif;
      font-size: 14px;
      line-height: 1.6;
    }
    .infobox b {
      color: #333;
    }
    .infobox small {
      color: #666;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <script>
    const apiKey = "90cf81e5f95e4742add10628251004";

    const points = [
      {
        label: "ÊúÄÂØÑ„Çä„ÅÆË¶≥Ê∏¨ÁÇπÔºë",
        requested: { lat: 36.39581509118606, lon: 138.75470162404676 }
      },
      {
        label: "ÊúÄÂØÑ„Çä„ÅÆË¶≥Ê∏¨ÁÇπÔºí",
        requested: { lat: 36.387917, lon: 138.688692 }
      }
    ];

    // Ëã±Ë™û„ÅÆÈ¢®Âêë ‚Üí Êó•Êú¨Ë™ûË™¨ÊòéÊñá
    const windDirectionMap = {
      N: "Âåó„Åã„ÇâÂçó„Å∏Âêπ„ÅèÈ¢®",
      NNE: "ÂåóÂåóÊù±„Åã„ÇâÂçóÂçóË•ø„Å∏Âêπ„ÅèÈ¢®",
      NE: "ÂåóÊù±„Åã„ÇâÂçóË•ø„Å∏Âêπ„ÅèÈ¢®",
      ENE: "Êù±ÂåóÊù±„Åã„ÇâË•øÂçóË•ø„Å∏Âêπ„ÅèÈ¢®",
      E: "Êù±„Åã„ÇâË•ø„Å∏Âêπ„ÅèÈ¢®",
      ESE: "Êù±ÂçóÊù±„Åã„ÇâË•øÂåóË•ø„Å∏Âêπ„ÅèÈ¢®",
      SE: "ÂçóÊù±„Åã„ÇâÂåóË•ø„Å∏Âêπ„ÅèÈ¢®",
      SSE: "ÂçóÂçóÊù±„Åã„ÇâÂåóÂåóË•ø„Å∏Âêπ„ÅèÈ¢®",
      S: "Âçó„Åã„ÇâÂåó„Å∏Âêπ„ÅèÈ¢®",
      SSW: "ÂçóÂçóË•ø„Åã„ÇâÂåóÂåóÊù±„Å∏Âêπ„ÅèÈ¢®",
      SW: "ÂçóË•ø„Åã„ÇâÂåóÊù±„Å∏Âêπ„ÅèÈ¢®",
      WSW: "Ë•øÂçóË•ø„Åã„ÇâÊù±ÂåóÊù±„Å∏Âêπ„ÅèÈ¢®",
      W: "Ë•ø„Åã„ÇâÊù±„Å∏Âêπ„ÅèÈ¢®",
      WNW: "Ë•øÂåóË•ø„Åã„ÇâÊù±ÂçóÊù±„Å∏Âêπ„ÅèÈ¢®",
      NW: "ÂåóË•ø„Åã„ÇâÂçóÊù±„Å∏Âêπ„ÅèÈ¢®",
      NNW: "ÂåóÂåóË•ø„Åã„ÇâÂçóÂçóÊù±„Å∏Âêπ„ÅèÈ¢®"
    };

    // Â§©Ê∞ó„ÅÆËã±Ë™û‚ÜíÊó•Êú¨Ë™ûË®≥„Éû„ÉÉ„Éó
    const weatherConditionMap = {
      "Sunny": "Êô¥„Çå",
      "Partly cloudy": "Êô¥„ÇåÊôÇ„ÄÖÊõá„Çä",
      "Cloudy": "Êõá„Çä",
      "Overcast": "ÊõáÂ§©",
      "Rain": "Èõ®",
      "Light rain": "Â∞èÈõ®",
      "Moderate rain": "Èõ®",
      "Heavy rain": "Â§ßÈõ®",
      "Snow": "Èõ™",
      "Light snow": "Â∞èÈõ™",
      "Moderate snow": "Èõ™",
      "Heavy snow": "Â§ßÈõ™",
      "Fog": "Èúß",
      "Mist": "„ÇÇ„ÇÑ"
    };

    async function fetchWeatherData(lat, lon) {
      const url = `https://api.weatherapi.com/v1/current.json?key=${apiKey}&q=${lat},${lon}`;
      const res = await fetch(url);
      return await res.json();
    }

    async function initMap() {
      const map = new google.maps.Map(document.getElementById("map"), {
        center: { lat: 36.39, lng: 138.72 },
        zoom: 11
      });

      const bounds = new google.maps.LatLngBounds();

      const tunnelPath = [
        { lat: 36.39581509118606, lng: 138.75470162404676 },
        { lat: 36.39784753441358, lng: 138.73138968184034 },
        { lat: 36.39822830844642, lng: 138.72610252090337 },
        { lat: 36.39822830844642, lng: 138.72151104015623 },
        { lat: 36.397735541689734, lng: 138.71636301628828 },
        { lat: 36.39681987346654, lng: 138.711354953857 },
        { lat: 36.39599000981058, lng: 138.7083778997922 },
        { lat: 36.39475647612527, lng: 138.7047590922183 },
        { lat: 36.387917, lng: 138.688692 }
      ];

      new google.maps.Polyline({
        path: tunnelPath,
        geodesic: true,
        strokeColor: "#FF0000",
        strokeOpacity: 0.8,
        strokeWeight: 8,
        map: map
      });

      tunnelPath.forEach(coord => bounds.extend(new google.maps.LatLng(coord.lat, coord.lng)));

      class CustomLabel extends google.maps.OverlayView {
        constructor(position, text, map) {
          super();
          this.position = position;
          this.text = text;
          this.div = null;
          this.setMap(map);
        }

        onAdd() {
          this.div = document.createElement("div");
          this.div.className = "custom-label";
          this.div.innerText = this.text;
          this.getPanes().overlayLayer.appendChild(this.div);
        }

        draw() {
          const projection = this.getProjection();
          const point = projection.fromLatLngToDivPixel(
            new google.maps.LatLng(this.position.lat, this.position.lng)
          );
          if (this.div) {
            this.div.style.left = `${point.x}px`;
            this.div.style.top = `${point.y}px`;
          }
        }

        onRemove() {
          if (this.div) this.div.remove();
        }
      }

      new CustomLabel({ lat: 36.393, lng: 138.721 }, "‰∏Ä„ÉéÁÄ¨„Éà„É≥„Éç„É´", map);

      for (let i = 0; i < points.length; i++) {
        const point = points[i];
        const data = await fetchWeatherData(point.requested.lat, point.requested.lon);
        const obs = data.location;
        const w = data.current;

        bounds.extend(new google.maps.LatLng(obs.lat, obs.lon));

        const windText = windDirectionMap[w.wind_dir] || w.wind_dir;
        const conditionText = weatherConditionMap[w.condition.text] || w.condition.text;

        const marker = new google.maps.Marker({
          position: { lat: obs.lat, lng: obs.lon },
          map,
          icon: {
            url: "https://maps.gstatic.com/mapfiles/ms2/micons/blue-dot.png",
            scaledSize: new google.maps.Size(32, 32)
          }
        });

        const info = new google.maps.InfoWindow({
          content: `
            <div class="infobox">
              <strong>${point.label}</strong><br>
              <b>Ê∞óÊ∏©:</b> ${w.temp_c} ‚ÑÉ<br>
              <b>ÊπøÂ∫¶:</b> ${w.humidity} %<br>
              <b>Ê∞óÂúß:</b> ${w.pressure_mb} hPa<br>
              <b>‰ΩìÊÑüÊ∏©Â∫¶:</b> ${w.feelslike_c} ‚ÑÉ<br>
              <b>È¢®Âêë:</b> ${windText}<br>
              <b>Â§©Ê∞ó:</b> ${conditionText}<br>
              <b>Ë¶≥Ê∏¨ÊôÇÂàª:</b> ${w.last_updated}<br>
              <small>üìçË¶≥Ê∏¨Âú∞ÁÇπ: (${obs.lat}, ${obs.lon})</small>
            </div>
          `
        });

        info.open(map, marker); // ÂàùÊúüË°®Á§∫„ÅßÈñã„Åè

        marker.addListener("click", () => {
          info.open(map, marker);
        });
      }

      map.fitBounds(bounds);
    }
  </script>

  <script async
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAuKjHdy5zGmnZ7niuvstAFR_yVScZUMqk&callback=initMap">
  </script>
</body>
</html>
